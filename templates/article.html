{% extends 'index.html' %}
{% load my_tag %}
{% block CSS %}
    <link rel="stylesheet" href="/static/editor-md/css/editormd.css">
    <link rel="stylesheet" href="/static/my/css/article.css">
{% endblock %}

{% block banner %}
    {% banner 'article' article %}
{% endblock %}

{% block main %}
<div class="article">
    <div class="slider_bar">
        <div class="title">
            悬浮目录
        </div>
        <div class="body">
            <p class="h1">什么是反向解析什么是反向解析什么是反向解析什么是反向解析什么是反向解析什么是反向解析</p>
            <p class="h2">名称空间</p>
            <p class="h4">名称空间</p>
            <p class="h5">名称空间</p>
            <p class="h6">名称空间</p>
            <p class="h6">名称空间</p>
        </div>
    </div>
    <div class="article_title">
        <h2>{{ article.title }}
            {% if request.user.is_superuser %}
            <a href="/backend/edit_article/{{ article.nid }}/"><i class="fas fa-edit"></i></a>
            {% endif %}
         </h2>
        <p>
            <span>发布时间:<i>{{ article.create_date|date:'Y-m-d' }}</i></span>
            <span>作者:<i>{{ article.author }}</i></span>
            <span>来源:<i>{{ article.source }}</i></span>
        </p>
        <div>
            {% if article.tag.all %}
            <i title = "文章标签" class="fas fa-tags"></i>
                {% for tag in article.tag.all %}
                    <i>{{ tag.title }}</i>
                {% endfor %}
            {% endif %}
        </div>
    </div>
    <div class="article_content" id = "article_content">
        <textarea style="display: none;">{{ article.content }}</textarea>
    </div>
    <div class="comment_submit">
        <div class="title">你觉得文章怎么样</div>
        {% csrf_token %}
        <div class="body">
            <textarea name="" id="" ref="comment_content" cols="30" rows="10" v-model="comment_content" placeholder="写下你想说的话,开始我们的对话"></textarea>
            <button class = 'submit_comment' @click="add_comment('{{ article.nid }}')">发布评论</button>
        </div>
        <div class="footer">
            <p>
                <span>{{ article.look_count }}</span>人参与
                <span>{{ article.comment_count }}</span>条评论
            </p>
        </div>
    </div>
    <div class="comment_list">
        <ul>
            {% for comment in comment_list %}
                <li>
                <div class="left">
                    <img src="{{ comment.user.avatar.url.url }}" alt="">
                </div>
                <div class="right">
                    <h4>{{ comment.user.username }}</h4>
                    <div class="comment_content">
                        {{ comment.content }}
                    </div>
                    <div class="comment_info">
                        <span>{{ comment.create_time }}</span>
                        <div>
                            <span>点赞（{{ comment.digg_count }}）</span>
                            <span @click="show_sub_comment_list($event, '{{ comment.user.username }}', '{{ comment.nid }}')">回复（{{ comment.comment_count }}）</span>
                            <span class ="delete" @click="delete_sub_comment('{{ comment.nid }}','{{ article.nid }}', null)">删除</span>
                        </div>
                    </div>
                    <div class="sub_comment_list">
                        {% for sub in comment.sub_comment %}
                            <div class="sub_comment_item">
                                <div class="left">
                                    <img src="{{ sub.user.avatar.url.url }}" alt="">
                                </div>
                                <div class="right">
                                    <h4>{{ sub.user.username }}@{{ sub.parent_comment.user.username }}</h4>
                                    <div class="sub_comment_content">
                                        {{ sub.content }}
                                    </div>
                                     <div class="sub_comment_info">
                                         <span>{{ sub.create_time}}</span>
                                         <div>
                                             <span>点赞（{{ sub.digg_count }}）</span>
                                             <span @click="sub_comment_set_placeholder($event, '{{ sub.user.username }}', '{{ sub.nid }}')">回复</span>
                                             {% if sub_user == request.user or request.user.is_superuser%}
                                                  <span class="delete" @click="delete_sub_comment('{{ sub.nid }}','{{ article.nid }}','{{ comment.nid }}')">删除</span>
                                             {% endif %}
                                         </div>
                                     </div>
                                </div>
                            </div>
                        {% endfor %}
                        <div class="sub_comment_textarea">
                            <textarea name="" id="" cols="30" rows="10" ref="sub_comment_content" placeholder="@zzz">

                            </textarea>
                            <button @click="add_sub_comment($event, '{{ article.nid }}')">回复</button>
                        </div>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}

{% block js %}
    <script src = '/static/editor-md/lib/marked.min.js'></script>
    <script src = '/static/editor-md/lib/prettify.min.js'></script>
    <script src = '/static/jquery/jquery.min.js'></script>
    <script src = '/static/editor-md/editormd.min.js'></script>
    <script type="text/javascript">
        $(function(){
            let editor = editormd.markdownToHTML("article_content",{
                width:"100%",
                heighr:"100%",
                path: "/static/editor-md/lib",
            })
        })
    </script>
{% endblock %}8